<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./panel/img/cedula.png" type="image/x-icon">
    <title>Tarjeta de Identificación</title>
    <!-- Incluir Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Incluir el CDN de html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container-fluid">
            <a class="navbar-brand" href="https://hospitaldecanelones.com/">
                <img src="./panel/img/hospitalDeCanelones.png" width="120" height="38" alt="Hospital de Canelones" class="img-fluid" style="border: 1px solid #fff; background-color: #fff; border-radius: 5px;">
            </a>
            <a class="navbar-brand" href="https://www.asse.com.uy/home">
                <img src="./panel/img/asse_capacita.png" width="150" height="38" alt="ASSE Capacita" class="img-fluid" style="border: 1px solid #fff; background-color: #fff; border-radius: 5px;">
            </a>
        </div>
    </nav>
    
    <!-- La tarjeta donde se visualizará la foto y la información -->
    <div class="d-flex justify-content-center">
        <div class="tarjeta mt-4">
            <div class="tarjeta">
                <!-- Contenedor para la foto capturada -->
                <div id="foto-con-marco" style="display:none;">
                    <img id="foto" src="" alt="Foto Capturada">
                </div>
                <!-- Fondo de la tarjeta -->
                <div class="background">
                    <img src="./panel/img/FondoTarjeta.png" alt="Fondo Tarjeta" class="fondo">

                    <!-- Foto -->
                    <div class="contenido">
                        <!-- Foto -->
                        <div class="photo-frame">
                            <video id="video" width="300" height="340" autoplay></video>
                        </div>
                    </div>

                    <!-- Logo Hospital de Canelones -->
                    <div class="hospital-logo">
                        <img class="hospital-logo-img" src="./panel/img/HospitalDeCanelones.png" alt="Hospital de Canelones">
                        <!-- Información de la persona -->
                        <div class="info">
                            <h1 id="nombre-text">Nombre y Apellido</h1>
                            <h3 id="sector-text">Sector</h3>
                            <h3 id="funcion-text">Funcion</h3>
                        </div>
                    </div>
                    <!-- Logos -->
                    <div class="logos">
                        <!-- Logo ASSE -->
                        <div class="logo logo-asse">
                            <img src="./panel/img/asse_capacita.png" alt="Logo ASSE">
                        </div>

                        <!-- Logo Región Sur -->
                        <div class="logo logo-region">
                            <img src="./panel/img/RegionSur.png" alt="Región Sur">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-4">
        <!-- Inputs y botones fuera de la tarjeta -->
        <div class="container mt-4">
            <div class="row">
                <!-- Columna para los inputs -->
                <div class="col-md-8">
                    <div class="inputs mb-4">
                        <label for="nombre">Nombre y Apellido:</label>
                        <input type="text" id="nombre" class="form-control mb-2" value="" placeholder="Ingrese su nombre">
        
                        <label for="sector">Sector:</label>
                        <select id="sector" class="form-control mb-2">
                            <option value="" disabled selected>...</option>
                            <option value="Dpto. Enfermería">Dpto. Enfermería</option>
                            <option value="Administración">Administración</option>
                            <option value="Informática">Informática</option>
                        </select>


                        <label for="funcion">Función:</label>
                        <select id="funcion" class="form-control mb-2" disabled>
                            <option value="" disabled selected>...</option>
                        </select>

                    </div>
                </div>
        
                <!-- Columna para el botón -->
                <div class="col-md-4 d-flex align-items-center"> <!-- Utilizando d-flex para centrar verticalmente -->
                    <button id="capturarYMostrar" class="btn btn-primary w-100" disabled>Capturar y Mostrar Tarjeta</button>

                </div>
            </div>
        </div>
        
    
        <!-- Modal para mostrar la tarjeta -->
        <div class="modal fade" id="modalTarjeta" tabindex="-1" aria-labelledby="modalTarjetaLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTarjetaLabel">Verifique que los datos ingresados esten bien</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Aquí se muestra la tarjeta -->
                        <div class="tarjeta">
                            <div id="foto-con-marco-modal" style="display:none;">
                                <img id="foto-modal" src="" alt="Foto Capturada">
                            </div>
                            <div class="background">
                                <img src="./panel/img/FondoTarjeta.png" alt="ImagenFicticia" class="fondo">

                                <div class="contenido">
                                    <div class="photo-frame">
                                        <img src="./panel/img/Persona.png" alt="Foto Capturada" Class="ImagenVideo">
                                    </div>
                                </div>

                                <div class="hospital-logo">
                                    <img class="hospital-logo-img" src="./panel/img/HospitalDeCanelones.png" alt="Hospital de Canelones">
                                    <div class="info">
                                        <h1 id="nombre-text-modal">Nombre y Apellido</h1>
                                        <h3 id="sector-text-modal"></h3>
                                        <h3 id="funcion-text-modal"></h3>
                                    </div>
                                </div>

                                <div class="logos">
                                    <div class="logo logo-asse">
                                        <img src="./panel/img/asse_capacita.png" alt="Logo ASSE">
                                    </div>
                                    <div class="logo logo-region">
                                        <img src="./panel/img/RegionSur.png" alt="Región Sur">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="imprimirTarjeta()">Siguiente</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <canvas id="canvas" width="1024" height="640" style="display:none;"></canvas>

    <!-- Incluir Bootstrap JS, Popper y mas -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script src="menuAutomatico.js"></script>
    <script>
        // Espera a que el DOM esté completamente cargado
        document.addEventListener("DOMContentLoaded", function() {
            const capturarYMostrar = document.getElementById('capturarYMostrar');
            
            capturarYMostrar.addEventListener('click', function() {
                const tarjeta = document.querySelector('.tarjeta'); // Cambia esto si tu tarjeta tiene una clase diferente
                const canvas = document.getElementById('canvas');
                const context = canvas.getContext('2d');

                html2canvas(tarjeta).then(function(canvas) {
                    const foto = canvas.toDataURL('image/png');
                    const fotomodal = canvas.toDataURL('imageModal/png');
                    document.getElementById('foto').src = foto; // Cambia a 'foto-modal' si es necesario
                    document.getElementById('video-modal').src = fotomodal;
                    document.getElementById('foto-con-marco').style.display = 'block'; // Cambia a 'foto-con-marco-modal' si es necesario

                    // Actualizar la tarjeta con la información del formulario
                    actualizarTarjeta();

                    // Mostrar el modal
                    const modal = new bootstrap.Modal(document.getElementById('modalTarjeta'));
                    modal.show();
                                            }).catch(function(error) {
                console.error("Error al capturar la tarjeta: ", error);
            });
        });

        // Iniciar la captura de video
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                const video = document.getElementById('video'); 
                video.srcObject = stream;
                video.play();
            })
            .catch(function(error) {
                console.error("Error accediendo a la cámara: ", error);
            });
    });
    </script>
</body>
</html>
